<!-- index.html -->

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Магазин цифровых товаров</title>
    <style>
        /* Ваши стили остаются без изменений */
    </style>
</head>
<body>

<div class="header">
    Магазин
</div>

<div class="product-list">
    <div class="product">
        <img src="https://via.placeholder.com/150" alt="Продукт 1">
        <div class="product-name">Цифровой товар 1</div>
        <button class="buy-button" data-product-id="1" data-product-name="Цифровой товар 1" data-price="100">Купить за 100₽</button>
    </div>
    <!-- Добавьте больше продуктов по аналогии -->
</div>

<script>
    // Инициализация MainButton
    Telegram.WebApp.ready();

    let selectedProduct = null;

    function buyProduct(productId, productName, price) {
        selectedProduct = {
            product_id: productId,
            product_name: productName,
            price: price
        };

        Telegram.WebApp.MainButton.setText(`Купить за ${price}₽`);
        Telegram.WebApp.MainButton.show();

        Telegram.WebApp.MainButton.onClick(function() {
            Telegram.WebApp.sendData(JSON.stringify(selectedProduct));
            Telegram.WebApp.MainButton.offClick();
            Telegram.WebApp.MainButton.hide();
        });
    }

    // Добавляем обработчик события на кнопки "Купить"
    document.querySelectorAll('.buy-button').forEach(button => {
        button.addEventListener('click', function() {
            const productId = this.getAttribute('data-product-id');
            const productName = this.getAttribute('data-product-name');
            const price = this.getAttribute('data-price');
            buyProduct(productId, productName, price);
        });
    });

    // Отладочный код для проверки доступности Telegram.WebApp
    if (window.Telegram.WebApp) {
        console.log("Telegram WebApp API доступен");
    } else {
        console.log("Telegram WebApp API недоступен");
        alert("Пожалуйста, откройте это приложение внутри Telegram.");
    }
</script>

</body>
</html>
